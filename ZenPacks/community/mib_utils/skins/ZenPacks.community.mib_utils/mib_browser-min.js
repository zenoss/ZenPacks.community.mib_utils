var isie=false;var oTextNodeMap={};var oCurrentTextNode=null;var oContextMenu=null;var oTreeView=false;var oid_window=false;var oid_form_action=false;var oid_name=false;var oid_access=false;var oid_status=false;var oid_node_type=false;var oid_description=false;var oid_number=false;var mib_url="";function open_oid_window(){var B=screen.availHeight-100;var A=0;if(!oid_window||oid_window.closed){oid_window=window.open("oid_details","oid_details","location=yes,scrollbars=yes,toolbar=no,status=no,resizable=no,width=250,height=275,left="+B+",top="+A);oid_window.onload=find_oid_detail_xml_frags}}function find_oid_detail_xml_frags(){var A=oid_window.document;oid_name=A.getElementById("oid_name");oid_access=A.getElementById("oid_access");oid_status=A.getElementById("oid_status");oid_node_type=A.getElementById("oid_node_type");oid_description=A.getElementById("oid_description");oid_number=A.getElementById("oid_number");oid_form_action=A.getElementById("form_save_oid")}function initAll(){var A=document.getElementById("mib_id");mib_name=A.getAttribute("name");mib_url=A.getAttribute("value");var B=getXMLHttpRequest();B.open("GET",mib_url,true);sendXMLHttpRequest(B).addCallback(process_XML_MIB_response);if(window.ActiveXObject){isie=true}open_oid_window()}function trim(A){return(A.replace(/(^\s*|\s*$)/,""))}function build_tree_from_nodes(C,D){var H,G,E;var J={};var K="";if(!D){return }var F=D.getElementsByTagName("node");for(H=0;F[H];H++){if(F[H].nodeType==1){next}try{K=trim(unescape(F[H].getElementsByTagName("description")[0].firstChild.nodeValue))}catch(I){K=""}var A={label:F[H].getAttribute("name"),title:K,style:"mib_treeview_label"};G=F[H].getAttribute("oid");var B=G.split(".");B.pop();var L=B.join(".");if(L in J){E=new YAHOO.widget.TextNode(A,J[L],false);J[G]=E}else{while(B.length>0){B.pop();L=B.join(".");if(L in J){E=new YAHOO.widget.TextNode(A,J[L],false);J[G]=E;break}}if(B.length==0){E=new YAHOO.widget.TextNode(A,C,false);J[G]=E}}E.data=F[H];oTextNodeMap[E.labelElId]=E}}function addNode(){var A=window.prompt("Enter a label for the new node: ",""),B;if(A&&A.length>0){B=new YAHOO.widget.TextNode(A,oCurrentTextNode,false);oCurrentTextNode.refresh();oCurrentTextNode.expand();oTextNodeMap[B.labelElId]=B}}function deleteNode(){var A=oCurrentTextNode.labelElId;if(A=="Nodes"||A=="Traps"){return }delete oTextNodeMap[oCurrentTextNode.labelElId];oTreeView.removeNode(oCurrentTextNode);oTreeView.draw()}function snmpwalk_oid(){var D;var C,A;if(oCurrentTextNode){D=oCurrentTextNode.data.getAttribute("oid")}else{return }if(D=="Nodes"||D=="Traps"){return }C=document.getElementById("test_device").value;A=document.getElementById("test_community").value;if(C==""||A==""){alert("Need to define a test server and community string!");return }var B="/zport/snmpwalk?device="+C+"&oid="+D+"&community="+A;snmpwalk_window=window.open(B,oCurrentTextNode.label,"location=yes,scrollbars=yes,toolbar=no,status=no,resizable=yes,width=600,height=400")}function onTriggerContextMenu(B){var A=this.contextEventTarget;if(A.className=="mib_treeview_label"){oCurrentTextNode=oTextNodeMap[A.id]}else{this.cancel()}}function add_root(A,C,F){var B=false;var E={label:A,title:C,style:"mib_treeview_label"};B=new YAHOO.widget.TextNode(E,oTreeView.getRoot(),false);oTextNodeMap[B.labelElId]=B;try{build_tree_from_nodes(B,F)}catch(D){alert("Failed to create tree for "+A+" because "+D.message)}}function display_oid_data(C){var B=C.data;var A;var E="";open_oid_window();find_oid_detail_xml_frags();oid_name.value=C.label;oid_number.value=B.getAttribute("oid");A=B.getAttribute("access");if(!A){oid_access.value=""}else{oid_access.value=A}A=B.getAttribute("status");if(!A){oid_status.value=""}else{oid_status.value=A}A=B.getAttribute("type");if(!A){oid_node_type.value=""}else{oid_node_type.value=A;if(A=="notification"){E=mib_url.replace(/showMibasXML/,"notifications/"+C.label);oid_form_action.setAttribute("action",E)}else{E=mib_url.replace(/showMibasXML/,"nodes/"+C.label);oid_form_action.setAttribute("action",E)}}try{oid_description.value=trim(unescape(B.getElementsByTagName("description")[0].firstChild.nodeValue))}catch(D){oid_description.value=""}oid_window.focus()}function mib_browser(D){oTreeView=new YAHOO.widget.TreeView("mib_browser");var A,C;A=D.getElementsByTagName("nodes")[0];add_root("Nodes","Root of the MIB",A);C=D.getElementsByTagName("notifications")[0];add_root("Traps","Notifications sent from the MIB agent",C);oTreeView.draw();var B={trigger:"mib_browser",lazyload:true,itemdata:[{text:"snmpwalk",onclick:{fn:snmpwalk_oid}}]};oContextMenu=new YAHOO.widget.ContextMenu("mytreecontextmenu",B);oContextMenu.subscribe("triggerContextMenu",onTriggerContextMenu);oContextMenu.cfg.setProperty("zindex",10);oTreeView.subscribe("labelClick",display_oid_data)}function display_MIB(C){var A=false;A=C.getElementsByTagName("module")[0];try{document.getElementById("mib_name").value=A.getAttribute("name")}catch(B){}try{document.getElementById("language").value=A.getAttribute("language")}catch(B){}try{document.getElementById("contact").value=trim(A.getElementsByTagName("contact")[0].firstChild.nodeValue)}catch(B){}try{document.getElementById("description").value=trim(unescape(A.getElementsByTagName("description")[0].firstChild.nodeValue))}catch(B){}mib_browser(C)}process_XML_MIB_response=function(C){var A=C.responseXML;var B=A.getElementsByTagName("smi")[0];if(B){display_MIB(B)}else{alert("\nUnable to parse out 'smi' element from server response\nTruncated XML response=\n"+C.responseText)}};